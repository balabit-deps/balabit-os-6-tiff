Description: fix heap overread in bmp2tiff
Bug: http://bugzilla.maptools.org/show_bug.cgi?id=2664
Origin: other, http://bugzilla.maptools.org/show_bug.cgi?id=2664

Index: tiff-4.0.6/tools/bmp2tiff.c
===================================================================
--- tiff-4.0.6.orig/tools/bmp2tiff.c	2018-03-22 10:06:00.428618291 -0400
+++ tiff-4.0.6/tools/bmp2tiff.c	2018-03-22 10:09:29.644942413 -0400
@@ -786,6 +786,14 @@ main(int argc, char* argv[])
 
 			_TIFFfree(comprbuf);
 
+			/* Check whether we are not going to read past the uncompressed data */
+			if ( length > j || width > j || length * width > j) {
+				TIFFError(infilename,
+                                          "Premature end of file");
+				_TIFFfree(uncomprbuf);
+				goto bad3;
+			}
+
 			for (row = 0; row < length; row++) {
 				if (TIFFWriteScanline(out,
                                                       uncomprbuf + (length - row - 1) * width,
